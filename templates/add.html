{% extends "base.html" %} {% block content %}
<h1>Add New Creature</h1>
<form method="POST" class="needs-validation" novalidate>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="name" class="form-label">Name</label>
      <input type="text" class="form-control" id="name" name="name" required />
    </div>
    <div class="col-md-4 mb-3">
      <label for="type" class="form-label">Type</label>
      <select class="form-select" id="type" name="type" required>
        <option value="aberration">Aberration</option>
        <option value="beast">Beast</option>
        <option value="celestial">Celestial</option>
        <option value="construct">Construct</option>
        <option value="dragon">Dragon</option>
        <option value="elemental">Elemental</option>
        <option value="fey">Fey</option>
        <option value="fiend">Fiend</option>
        <option value="giant">Giant</option>
        <option value="humanoid">Humanoid</option>
        <option value="monstrosity">Monstrosity</option>
        <option value="ooze">Ooze</option>
        <option value="plant">Plant</option>
        <option value="undead">Undead</option>
      </select>
    </div>
    <div class="col-md-2 mb-3">
      <label for="type_tag" class="form-label">Type Tag (Optional)</label>
      <input
        type="text"
        class="form-control"
        id="type_tag"
        name="type_tag"
        placeholder="e.g. orc"
      />
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-3">
      <label for="size" class="form-label">Size</label>
      <select class="form-select" id="size" name="size" value="Medium" required>
        <option value="Tiny">Tiny</option>
        <option value="Small">Small</option>
        <option value="Medium">Medium</option>
        <option value="Large">Large</option>
        <option value="Huge">Huge</option>
        <option value="Gargantuan">Gargantuan</option>
      </select>
    </div>
    <div class="col-md-4 mb-3">
      <label for="alignment" class="form-label">Alignment</label>
      <select class="form-select" id="alignment" name="alignment" required>
        <option value="lawful good">Lawful Good</option>
        <option value="lawful neutral">Lawful Neutral</option>
        <option value="lawful evil">Lawful Evil</option>
        <option value="neutral good">Neutral Good</option>
        <option value="true neutral">True Neutral</option>
        <option value="neutral evil">Neutral Evil</option>
        <option value="chaotic good">Chaotic Good</option>
        <option value="chaotic neutral">Chaotic Neutral</option>
        <option value="chaotic evil">Chaotic Evil</option>
        <option value="unaligned">Unaligned</option>
      </select>
    </div>
    <div class="col-md-4 mb-3">
      <label for="challenge_rating" class="form-label">Challenge Rating</label>
      <select
        class="form-select"
        id="challenge_rating"
        name="challenge_rating"
        required
      >
        <option value="0">0</option>
        <option value="0.125">1/8</option>
        <option value="0.25">1/4</option>
        <option value="0.5">1/2</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
      </select>
    </div>
  </div>

  <div class="mb-3">
    <label for="desc" class="form-label">Description</label>
    <textarea
      class="form-control"
      id="desc"
      name="desc"
      rows="3"
      required
    ></textarea>
  </div>

  <div class="mb-3">
    <label for="salvage" class="form-label"
      >Salvage Information (Optional)</label
    >
    <textarea
      class="form-control"
      id="salvage"
      name="salvage"
      rows="3"
    ></textarea>
    <div class="form-text">
      Leave blank if no salvage information is available.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Lore (Optional)</label>
    <div id="lore-container">
      <div class="input-group mb-2">
        <input
          type="text"
          class="form-control"
          name="lore[]"
          placeholder="Enter lore entry"
        />
        <button
          type="button"
          class="btn btn-danger remove-lore"
          onclick="removeLoreEntry(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addLoreEntry()">
      Add Lore Entry
    </button>
    <div class="form-text">
      Add any relevant lore entries. Leave empty if no lore is available.
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-3">
      <label for="armor_class" class="form-label">Armor Class</label>
      <input
        type="number"
        class="form-control"
        id="armor_class"
        name="armor_class"
      />
    </div>
    <div class="col-md-4 mb-3">
      <label for="hit_points" class="form-label">Hit Points</label>
      <input
        type="number"
        class="form-control"
        id="hit_points"
        name="hit_points"
      />
    </div>
    <div class="col-md-4 mb-3">
      <label for="hit_dice" class="form-label">Hit Dice</label>
      <input type="text" class="form-control" id="hit_dice" name="hit_dice" />
    </div>
  </div>

  <h3 class="mt-4">Speed (Optional)</h3>
  <div class="row">
    <div class="col-md-4 mb-3">
      <label for="speed_walk" class="form-label">Walk</label>
      <input
        type="text"
        class="form-control"
        id="speed_walk"
        name="speed_walk"
        placeholder="e.g. 30 ft."
        value="30 ft."
      />
    </div>
    <div class="col-md-4 mb-3">
      <label for="speed_fly" class="form-label">Fly</label>
      <input
        type="text"
        class="form-control"
        id="speed_fly"
        name="speed_fly"
        placeholder="e.g. 60 ft."
      />
    </div>
    <div class="col-md-4 mb-3">
      <label for="speed_swim" class="form-label">Swim</label>
      <input
        type="text"
        class="form-control"
        id="speed_swim"
        name="speed_swim"
        placeholder="e.g. 30 ft."
      />
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="speed_climb" class="form-label">Climb</label>
      <input
        type="text"
        class="form-control"
        id="speed_climb"
        name="speed_climb"
        placeholder="e.g. 30 ft."
      />
    </div>
    <div class="col-md-6 mb-3">
      <label for="speed_burrow" class="form-label">Burrow</label>
      <input
        type="text"
        class="form-control"
        id="speed_burrow"
        name="speed_burrow"
        placeholder="e.g. 20 ft."
      />
    </div>
  </div>
  <div class="form-text mb-3">
    Enter speeds in feet (ft.) or leave blank if the creature doesn't have that
    movement type.
  </div>

  <h3 class="mt-4">Ability Scores</h3>
  <div class="row">
    <div class="col-md-2 mb-3">
      <label for="strength" class="form-label">STR</label>
      <input
        type="number"
        class="form-control"
        id="strength"
        name="strength"
        value="10"
      />
    </div>
    <div class="col-md-2 mb-3">
      <label for="dexterity" class="form-label">DEX</label>
      <input
        type="number"
        class="form-control"
        id="dexterity"
        name="dexterity"
        value="10"
      />
    </div>
    <div class="col-md-2 mb-3">
      <label for="constitution" class="form-label">CON</label>
      <input
        type="number"
        class="form-control"
        id="constitution"
        name="constitution"
        value="10"
      />
    </div>
    <div class="col-md-2 mb-3">
      <label for="intelligence" class="form-label">INT</label>
      <input
        type="number"
        class="form-control"
        id="intelligence"
        name="intelligence"
        value="10"
      />
    </div>
    <div class="col-md-2 mb-3">
      <label for="wisdom" class="form-label">WIS</label>
      <input
        type="number"
        class="form-control"
        id="wisdom"
        name="wisdom"
        value="10"
      />
    </div>
    <div class="col-md-2 mb-3">
      <label for="charisma" class="form-label">CHA</label>
      <input
        type="number"
        class="form-control"
        id="charisma"
        name="charisma"
        value="10"
      />
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="languages" class="form-label">Languages</label>
      <input
        type="text"
        class="form-control"
        id="languages"
        name="languages"
        value="common"
      />
    </div>
    <div class="col-md-6 mb-3">
      <label for="passive_perception" class="form-label"
        >Passive Perception</label
      >
      <input
        type="number"
        class="form-control"
        id="passive_perception"
        name="passive_perception"
        value="13"
        required
      />
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Special Senses (Optional)</label>
    <div id="senses-container">
      <div class="input-group mb-2">
        <select class="form-select sense-type" name="sense_type[]">
          <option value="">Select sense...</option>
          <option value="blindsight">Blindsight</option>
          <option value="darkvision">Darkvision</option>
          <option value="tremorsense">Tremorsense</option>
          <option value="truesight">Truesight</option>
        </select>
        <input
          type="number"
          class="form-control"
          name="sense_range[]"
          placeholder="Range in feet"
          min="0"
        />
        <button
          type="button"
          class="btn btn-danger remove-sense"
          onclick="removeSense(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addSense()">
      Add Special Sense
    </button>
    <div class="form-text">
      Add any special senses the creature has, with their range in feet.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Special Abilities (Optional)</label>
    <div id="abilities-container">
      <div class="input-group mb-2">
        <input
          type="text"
          class="form-control"
          name="ability_name[]"
          placeholder="Ability name"
          style="max-width: 200px"
        />
        <textarea
          class="form-control"
          name="ability_desc[]"
          placeholder="Ability description"
          rows="2"
        ></textarea>
        <button
          type="button"
          class="btn btn-danger remove-ability"
          onclick="removeAbility(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addAbility()">
      Add Special Ability
    </button>
    <div class="form-text">
      Add any special abilities the creature has, with their names and
      descriptions.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Proficiencies (Optional)</label>
    <div id="proficiencies-container">
      <div class="input-group mb-2">
        <select
          class="form-select proficiency-type"
          name="proficiency_type[]"
          onchange="updateProficiencyOptions(this)"
        >
          <option value="">Select type...</option>
          <option value="saving-throw">Saving Throw</option>
          <option value="skill">Skill</option>
        </select>
        <select
          class="form-select proficiency-name"
          name="proficiency_name[]"
          disabled
        >
          <option value="">Select proficiency...</option>
        </select>
        <input
          type="number"
          class="form-control"
          name="proficiency_value[]"
          placeholder="Value"
          min="-5"
          max="30"
        />
        <button
          type="button"
          class="btn btn-danger remove-proficiency"
          onclick="removeProficiency(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addProficiency()">
      Add Proficiency
    </button>
    <div class="form-text">
      Add saving throws and skills the creature is proficient in.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Damage Vulnerabilities (Optional)</label>
    <div id="vulnerabilities-container">
      <div class="input-group mb-2">
        <select class="form-select damage-type" name="vulnerability[]">
          <option value="">Select damage type...</option>
          <option value="Piercing">Piercing</option>
          <option value="Slashing">Slashing</option>
          <option value="Bludgeoning">Bludgeoning</option>
          <option value="Acid">Acid</option>
          <option value="Cold">Cold</option>
          <option value="Fire">Fire</option>
          <option value="Force">Force</option>
          <option value="Lightning">Lightning</option>
          <option value="Necrotic">Necrotic</option>
          <option value="Poison">Poison</option>
          <option value="Psychic">Psychic</option>
          <option value="Radiant">Radiant</option>
          <option value="Thunder">Thunder</option>
        </select>
        <button
          type="button"
          class="btn btn-danger remove-damage"
          onclick="removeDamageType(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-secondary"
      onclick="addDamageType('vulnerabilities')"
    >
      Add Vulnerability
    </button>
    <div class="form-check mt-2">
      <input
        class="form-check-input"
        type="checkbox"
        id="vulnerability-nonmagical"
        name="vulnerability-nonmagical"
      />
      <label class="form-check-label" for="vulnerability-nonmagical">
        Include nonmagical weapon damage types
      </label>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Damage Resistances (Optional)</label>
    <div id="resistances-container">
      <div class="input-group mb-2">
        <select class="form-select damage-type" name="resistance[]">
          <option value="">Select damage type...</option>
          <option value="Piercing">Piercing</option>
          <option value="Slashing">Slashing</option>
          <option value="Bludgeoning">Bludgeoning</option>
          <option value="Acid">Acid</option>
          <option value="Cold">Cold</option>
          <option value="Fire">Fire</option>
          <option value="Force">Force</option>
          <option value="Lightning">Lightning</option>
          <option value="Necrotic">Necrotic</option>
          <option value="Poison">Poison</option>
          <option value="Psychic">Psychic</option>
          <option value="Radiant">Radiant</option>
          <option value="Thunder">Thunder</option>
        </select>
        <button
          type="button"
          class="btn btn-danger remove-damage"
          onclick="removeDamageType(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-secondary"
      onclick="addDamageType('resistances')"
    >
      Add Resistance
    </button>
    <div class="form-check mt-2">
      <input
        class="form-check-input"
        type="checkbox"
        id="resistance-nonmagical"
        name="resistance-nonmagical"
      />
      <label class="form-check-label" for="resistance-nonmagical">
        Include nonmagical weapon damage types
      </label>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Damage Immunities (Optional)</label>
    <div id="immunities-container">
      <div class="input-group mb-2">
        <select class="form-select damage-type" name="immunity[]">
          <option value="">Select damage type...</option>
          <option value="Piercing">Piercing</option>
          <option value="Slashing">Slashing</option>
          <option value="Bludgeoning">Bludgeoning</option>
          <option value="Acid">Acid</option>
          <option value="Cold">Cold</option>
          <option value="Fire">Fire</option>
          <option value="Force">Force</option>
          <option value="Lightning">Lightning</option>
          <option value="Necrotic">Necrotic</option>
          <option value="Poison">Poison</option>
          <option value="Psychic">Psychic</option>
          <option value="Radiant">Radiant</option>
          <option value="Thunder">Thunder</option>
        </select>
        <button
          type="button"
          class="btn btn-danger remove-damage"
          onclick="removeDamageType(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-secondary"
      onclick="addDamageType('immunities')"
    >
      Add Immunity
    </button>
    <div class="form-check mt-2">
      <input
        class="form-check-input"
        type="checkbox"
        id="immunity-nonmagical"
        name="immunity-nonmagical"
      />
      <label class="form-check-label" for="immunity-nonmagical">
        Include nonmagical weapon damage types
      </label>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Condition Immunities (Optional)</label>
    <div id="condition-immunities-container">
      <div class="input-group mb-2">
        <select class="form-select condition-type" name="condition_immunity[]">
          <option value="">Select condition...</option>
          <option value="Blinded">Blinded</option>
          <option value="Charmed">Charmed</option>
          <option value="Deafened">Deafened</option>
          <option value="Exhaustion">Exhaustion</option>
          <option value="Frightened">Frightened</option>
          <option value="Grappled">Grappled</option>
          <option value="Incapacitated">Incapacitated</option>
          <option value="Invisible">Invisible</option>
          <option value="Necrotic">Necrotic</option>
          <option value="Paralyzed">Paralyzed</option>
          <option value="Petrified">Petrified</option>
          <option value="Poisoned">Poisoned</option>
          <option value="Prone">Prone</option>
          <option value="Restrained">Restrained</option>
          <option value="Stunned">Stunned</option>
          <option value="Unconscious">Unconscious</option>
        </select>
        <button
          type="button"
          class="btn btn-danger remove-condition"
          onclick="removeCondition(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addCondition()">
      Add Condition Immunity
    </button>
  </div>

  <div class="mb-3">
    <label class="form-label">Actions (Optional)</label>
    <div id="actions-container">
      <div class="action-entry mb-3 p-3 border rounded">
        <div class="row mb-2">
          <div class="col-md-6">
            <input
              type="text"
              class="form-control"
              name="action_name[]"
              placeholder="Action name"
            />
          </div>
          <div class="col-md-4">
            <input
              type="number"
              class="form-control"
              name="action_attack_bonus[]"
              placeholder="Attack bonus"
            />
          </div>
          <div class="col-md-2">
            <button
              type="button"
              class="btn btn-danger w-100"
              onclick="removeAction(this)"
            >
              Remove
            </button>
          </div>
        </div>
        <div class="mb-2">
          <textarea
            class="form-control"
            name="action_desc[]"
            placeholder="Action description (e.g. Melee Weapon Attack: +24 to hit, reach 10 ft., one target)"
            rows="2"
          ></textarea>
        </div>
        <div class="damage-section mb-2">
          <label class="form-label">Damage</label>
          <div class="damage-entries">
            <div class="damage-entry input-group mb-2">
              <select
                class="form-select damage-type"
                name="action_damage_type[]"
              >
                <option value="">Select damage type...</option>
                <option value="piercing">Piercing</option>
                <option value="slashing">Slashing</option>
                <option value="bludgeoning">Bludgeoning</option>
                <option value="acid">Acid</option>
                <option value="cold">Cold</option>
                <option value="fire">Fire</option>
                <option value="force">Force</option>
                <option value="lightning">Lightning</option>
                <option value="necrotic">Necrotic</option>
                <option value="poison">Poison</option>
                <option value="psychic">Psychic</option>
                <option value="radiant">Radiant</option>
                <option value="thunder">Thunder</option>
              </select>
              <input
                type="text"
                class="form-control"
                name="action_damage_dice[]"
                placeholder="Damage dice (e.g. 4d6+9)"
              />
              <button
                type="button"
                class="btn btn-danger"
                onclick="removeDamageEntry(this)"
              >
                Remove
              </button>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-secondary btn-sm"
            onclick="addDamageEntry(this)"
          >
            Add Damage Type
          </button>
        </div>
        <div class="nested-actions-section mb-2">
          <label class="form-label">Nested Actions (Optional)</label>
          <div class="nested-actions">
            <!-- Nested actions will be added here -->
          </div>
          <button
            type="button"
            class="btn btn-secondary btn-sm"
            onclick="addNestedAction(this)"
          >
            Add Nested Action
          </button>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addAction()">
      Add Action
    </button>
    <div class="form-text">
      Add creature actions with their names, descriptions, attack bonuses, and
      damage information.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Reactions (Optional)</label>
    <div id="reactions-container">
      <div class="input-group mb-2">
        <input
          type="text"
          class="form-control"
          name="reaction_name[]"
          placeholder="Reaction name"
          style="max-width: 200px"
        />
        <textarea
          class="form-control"
          name="reaction_desc[]"
          placeholder="Reaction description"
          rows="2"
        ></textarea>
        <button
          type="button"
          class="btn btn-danger remove-reaction"
          onclick="removeReaction(this)"
        >
          Remove
        </button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary" onclick="addReaction()">
      Add Reaction
    </button>
    <div class="form-text">
      Add any reactions the creature has, with their names and descriptions.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Legendary Actions (Optional)</label>
    <div id="legendary-actions-container">
      <div class="legendary-action-entry mb-3 p-3 border rounded">
        <div class="input-group mb-2">
          <input
            type="text"
            class="form-control"
            name="legendary_action_name[]"
            placeholder="Legendary action name"
            style="max-width: 200px"
          />
          <textarea
            class="form-control"
            name="legendary_action_desc[]"
            placeholder="Legendary action description"
            rows="2"
          ></textarea>
          <button
            type="button"
            class="btn btn-danger remove-legendary-action"
            onclick="removeLegendaryAction(this)"
          >
            Remove
          </button>
        </div>
        <div class="nested-actions-section mb-2">
          <label class="form-label">Nested Actions (Optional)</label>
          <div class="nested-actions">
            <!-- Nested actions will be added here -->
          </div>
          <button
            type="button"
            class="btn btn-secondary btn-sm"
            onclick="addNestedLegendaryAction(this)"
          >
            Add Nested Action
          </button>
        </div>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-secondary"
      onclick="addLegendaryAction()"
    >
      Add Legendary Action
    </button>
    <div class="form-text">
      Add legendary actions the creature can take, with their names and
      descriptions.
    </div>
  </div>

  <div class="mb-3">
    <button type="submit" class="btn btn-primary">Add Creature</button>
    <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
  </div>
</form>

<script>
  // Form validation
  (function () {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener(
        'submit',
        function (event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        },
        false
      );
    });
  })();

  // Lore entry management
  function addLoreEntry() {
    const container = document.getElementById('lore-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <input type="text" class="form-control" name="lore[]" placeholder="Enter lore entry">
      <button type="button" class="btn btn-danger remove-lore" onclick="removeLoreEntry(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeLoreEntry(button) {
    const entry = button.parentElement;
    const container = document.getElementById('lore-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Proficiency management
  const savingThrows = [
    { value: 'saving-throw-str', name: 'Saving Throw: STR' },
    { value: 'saving-throw-dex', name: 'Saving Throw: DEX' },
    { value: 'saving-throw-con', name: 'Saving Throw: CON' },
    { value: 'saving-throw-int', name: 'Saving Throw: INT' },
    { value: 'saving-throw-wis', name: 'Saving Throw: WIS' },
    { value: 'saving-throw-cha', name: 'Saving Throw: CHA' },
  ];

  const skills = [
    { value: 'skill-athletics', name: 'Skill: Athletics' },
    { value: 'skill-acrobatics', name: 'Skill: Acrobatics' },
    { value: 'skill-sleight-of-hand', name: 'Skill: Sleight of Hand' },
    { value: 'skill-stealth', name: 'Skill: Stealth' },
    { value: 'skill-arcana', name: 'Skill: Arcana' },
    { value: 'skill-history', name: 'Skill: History' },
    { value: 'skill-investigation', name: 'Skill: Investigation' },
    { value: 'skill-nature', name: 'Skill: Nature' },
    { value: 'skill-religion', name: 'Skill: Religion' },
    { value: 'skill-animal-handling', name: 'Skill: Animal Handling' },
    { value: 'skill-insight', name: 'Skill: Insight' },
    { value: 'skill-medicine', name: 'Skill: Medicine' },
    { value: 'skill-perception', name: 'Skill: Perception' },
    { value: 'skill-survival', name: 'Skill: Survival' },
    { value: 'skill-intimidation', name: 'Skill: Intimidation' },
    { value: 'skill-performance', name: 'Skill: Performance' },
    { value: 'skill-persuasion', name: 'Skill: Persuasion' },
    { value: 'skill-deception', name: 'Skill: Deception' },
  ];

  function updateProficiencyOptions(select) {
    const type = select.value;
    const nameSelect = select.parentElement.querySelector('.proficiency-name');
    nameSelect.innerHTML = '<option value="">Select proficiency...</option>';
    nameSelect.disabled = !type;

    if (type === 'saving-throw') {
      savingThrows.forEach((throw_) => {
        const option = document.createElement('option');
        option.value = throw_.value;
        option.textContent = throw_.name;
        nameSelect.appendChild(option);
      });
    } else if (type === 'skill') {
      skills.forEach((skill) => {
        const option = document.createElement('option');
        option.value = skill.value;
        option.textContent = skill.name;
        nameSelect.appendChild(option);
      });
    }
  }

  function addProficiency() {
    const container = document.getElementById('proficiencies-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <select class="form-select proficiency-type" name="proficiency_type[]" onchange="updateProficiencyOptions(this)">
        <option value="">Select type...</option>
        <option value="saving-throw">Saving Throw</option>
        <option value="skill">Skill</option>
      </select>
      <select class="form-select proficiency-name" name="proficiency_name[]" disabled>
        <option value="">Select proficiency...</option>
      </select>
      <input type="number" class="form-control" name="proficiency_value[]" placeholder="Value" min="-5" max="30">
      <button type="button" class="btn btn-danger remove-proficiency" onclick="removeProficiency(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeProficiency(button) {
    const entry = button.parentElement;
    const container = document.getElementById('proficiencies-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Damage type management
  function addDamageType(type) {
    const container = document.getElementById(`${type}-container`);
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <select class="form-select damage-type" name="${type}[]">
        <option value="">Select damage type...</option>
        <option value="Piercing">Piercing</option>
        <option value="Slashing">Slashing</option>
        <option value="Bludgeoning">Bludgeoning</option>
        <option value="Acid">Acid</option>
        <option value="Cold">Cold</option>
        <option value="Fire">Fire</option>
        <option value="Force">Force</option>
        <option value="Lightning">Lightning</option>
        <option value="Necrotic">Necrotic</option>
        <option value="Poison">Poison</option>
        <option value="Psychic">Psychic</option>
        <option value="Radiant">Radiant</option>
        <option value="Thunder">Thunder</option>
      </select>
      <button type="button" class="btn btn-danger remove-damage" onclick="removeDamageType(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeDamageType(button) {
    const entry = button.parentElement;
    const container = entry.parentElement;

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Condition immunity management
  function addCondition() {
    const container = document.getElementById('condition-immunities-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <select class="form-select condition-type" name="condition_immunity[]">
        <option value="">Select condition...</option>
        <option value="Blinded">Blinded</option>
        <option value="Charmed">Charmed</option>
        <option value="Deafened">Deafened</option>
        <option value="Exhaustion">Exhaustion</option>
        <option value="Frightened">Frightened</option>
        <option value="Grappled">Grappled</option>
        <option value="Incapacitated">Incapacitated</option>
        <option value="Invisible">Invisible</option>
        <option value="Necrotic">Necrotic</option>
        <option value="Paralyzed">Paralyzed</option>
        <option value="Petrified">Petrified</option>
        <option value="Poisoned">Poisoned</option>
        <option value="Prone">Prone</option>
        <option value="Restrained">Restrained</option>
        <option value="Stunned">Stunned</option>
        <option value="Unconscious">Unconscious</option>
      </select>
      <button type="button" class="btn btn-danger remove-condition" onclick="removeCondition(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeCondition(button) {
    const entry = button.parentElement;
    const container = document.getElementById('condition-immunities-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Special senses management
  function addSense() {
    const container = document.getElementById('senses-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <select class="form-select sense-type" name="sense_type[]">
        <option value="">Select sense...</option>
        <option value="blindsight">Blindsight</option>
        <option value="darkvision">Darkvision</option>
        <option value="tremorsense">Tremorsense</option>
        <option value="truesight">Truesight</option>
      </select>
      <input type="number" class="form-control" name="sense_range[]" placeholder="Range in feet" min="0">
      <button type="button" class="btn btn-danger remove-sense" onclick="removeSense(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeSense(button) {
    const entry = button.parentElement;
    const container = document.getElementById('senses-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Special abilities management
  function addAbility() {
    const container = document.getElementById('abilities-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <input type="text" class="form-control" name="ability_name[]" placeholder="Ability name" style="max-width: 200px;">
      <textarea class="form-control" name="ability_desc[]" placeholder="Ability description" rows="2"></textarea>
      <button type="button" class="btn btn-danger remove-ability" onclick="removeAbility(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeAbility(button) {
    const entry = button.parentElement;
    const container = document.getElementById('abilities-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Actions management
  function addAction() {
    const container = document.getElementById('actions-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'action-entry mb-3 p-3 border rounded';
    newEntry.innerHTML = `
      <div class="row mb-2">
        <div class="col-md-6">
          <input type="text" class="form-control" name="action_name[]" placeholder="Action name">
        </div>
        <div class="col-md-4">
          <input type="number" class="form-control" name="action_attack_bonus[]" placeholder="Attack bonus">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-danger w-100" onclick="removeAction(this)">Remove</button>
        </div>
      </div>
      <div class="mb-2">
        <textarea class="form-control" name="action_desc[]" placeholder="Action description (e.g. Melee Weapon Attack: +24 to hit, reach 10 ft., one target)" rows="2"></textarea>
      </div>
      <div class="damage-section mb-2">
        <label class="form-label">Damage</label>
        <div class="damage-entries">
          <div class="damage-entry input-group mb-2">
            <select class="form-select damage-type" name="action_damage_type[]">
              <option value="">Select damage type...</option>
              <option value="piercing">Piercing</option>
              <option value="slashing">Slashing</option>
              <option value="bludgeoning">Bludgeoning</option>
              <option value="acid">Acid</option>
              <option value="cold">Cold</option>
              <option value="fire">Fire</option>
              <option value="force">Force</option>
              <option value="lightning">Lightning</option>
              <option value="necrotic">Necrotic</option>
              <option value="poison">Poison</option>
              <option value="psychic">Psychic</option>
              <option value="radiant">Radiant</option>
              <option value="thunder">Thunder</option>
            </select>
            <input type="text" class="form-control" name="action_damage_dice[]" placeholder="Damage dice (e.g. 4d6+9)">
            <button type="button" class="btn btn-danger" onclick="removeDamageEntry(this)">Remove</button>
          </div>
        </div>
        <button type="button" class="btn btn-secondary btn-sm" onclick="addDamageEntry(this)">Add Damage Type</button>
      </div>
      <div class="nested-actions-section mb-2">
        <label class="form-label">Nested Actions (Optional)</label>
        <div class="nested-actions">
          <!-- Nested actions will be added here -->
        </div>
        <button type="button" class="btn btn-secondary btn-sm" onclick="addNestedAction(this)">Add Nested Action</button>
      </div>
    `;
    container.appendChild(newEntry);
  }

  function removeAction(button) {
    const entry = button.closest('.action-entry');
    const container = document.getElementById('actions-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  function addDamageEntry(button) {
    const damageSection = button.closest('.damage-section');
    const entriesContainer = damageSection.querySelector('.damage-entries');
    const newEntry = document.createElement('div');
    newEntry.className = 'damage-entry input-group mb-2';
    newEntry.innerHTML = `
      <select class="form-select damage-type" name="action_damage_type[]">
        <option value="">Select damage type...</option>
        <option value="piercing">Piercing</option>
        <option value="slashing">Slashing</option>
        <option value="bludgeoning">Bludgeoning</option>
        <option value="acid">Acid</option>
        <option value="cold">Cold</option>
        <option value="fire">Fire</option>
        <option value="force">Force</option>
        <option value="lightning">Lightning</option>
        <option value="necrotic">Necrotic</option>
        <option value="poison">Poison</option>
        <option value="psychic">Psychic</option>
        <option value="radiant">Radiant</option>
        <option value="thunder">Thunder</option>
      </select>
      <input type="text" class="form-control" name="action_damage_dice[]" placeholder="Damage dice (e.g. 4d6+9)">
      <button type="button" class="btn btn-danger" onclick="removeDamageEntry(this)">Remove</button>
    `;
    entriesContainer.appendChild(newEntry);
  }

  function removeDamageEntry(button) {
    const entry = button.closest('.damage-entry');
    const entriesContainer = entry.parentElement;

    // Don't remove if it's the last entry
    if (entriesContainer.children.length > 1) {
      entry.remove();
    }
  }

  function addNestedAction(button) {
    const nestedSection = button.closest('.nested-actions-section');
    const nestedContainer = nestedSection.querySelector('.nested-actions');
    const newEntry = document.createElement('div');
    newEntry.className = 'nested-action mb-2 p-2 border rounded';
    newEntry.innerHTML = `
      <div class="row mb-2">
        <div class="col-md-6">
          <input type="text" class="form-control" name="nested_action_name[]" placeholder="Nested action name">
        </div>
        <div class="col-md-4">
          <input type="number" class="form-control" name="nested_action_attack_bonus[]" placeholder="Attack bonus">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-danger w-100" onclick="removeNestedAction(this)">Remove</button>
        </div>
      </div>
      <div class="mb-2">
        <textarea class="form-control" name="nested_action_desc[]" placeholder="Nested action description" rows="2"></textarea>
      </div>
    `;
    nestedContainer.appendChild(newEntry);
  }

  function removeNestedAction(button) {
    const entry = button.closest('.nested-action');
    entry.remove();
  }

  // Reactions management
  function addReaction() {
    const container = document.getElementById('reactions-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'input-group mb-2';
    newEntry.innerHTML = `
      <input type="text" class="form-control" name="reaction_name[]" placeholder="Reaction name" style="max-width: 200px;">
      <textarea class="form-control" name="reaction_desc[]" placeholder="Reaction description" rows="2"></textarea>
      <button type="button" class="btn btn-danger remove-reaction" onclick="removeReaction(this)">Remove</button>
    `;
    container.appendChild(newEntry);
  }

  function removeReaction(button) {
    const entry = button.parentElement;
    const container = document.getElementById('reactions-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  // Legendary actions management
  function addLegendaryAction() {
    const container = document.getElementById('legendary-actions-container');
    const newEntry = document.createElement('div');
    newEntry.className = 'legendary-action-entry mb-3 p-3 border rounded';
    newEntry.innerHTML = `
      <div class="input-group mb-2">
        <input type="text" class="form-control" name="legendary_action_name[]" placeholder="Legendary action name" style="max-width: 200px;">
        <textarea class="form-control" name="legendary_action_desc[]" placeholder="Legendary action description" rows="2"></textarea>
        <button type="button" class="btn btn-danger remove-legendary-action" onclick="removeLegendaryAction(this)">Remove</button>
      </div>
      <div class="nested-actions-section mb-2">
        <label class="form-label">Nested Actions (Optional)</label>
        <div class="nested-actions">
          <!-- Nested actions will be added here -->
        </div>
        <button type="button" class="btn btn-secondary btn-sm" onclick="addNestedLegendaryAction(this)">Add Nested Action</button>
      </div>
    `;
    container.appendChild(newEntry);
  }

  function removeLegendaryAction(button) {
    const entry = button.closest('.legendary-action-entry');
    const container = document.getElementById('legendary-actions-container');

    // Don't remove if it's the last entry
    if (container.children.length > 1) {
      entry.remove();
    }
  }

  function addNestedLegendaryAction(button) {
    const nestedSection = button.closest('.nested-actions-section');
    const nestedContainer = nestedSection.querySelector('.nested-actions');
    const newEntry = document.createElement('div');
    newEntry.className = 'nested-action mb-2 p-2 border rounded';
    newEntry.innerHTML = `
      <div class="row mb-2">
        <div class="col-md-6">
          <input type="text" class="form-control" name="nested_legendary_action_name[]" placeholder="Nested action name">
        </div>
        <div class="col-md-4">
          <input type="number" class="form-control" name="nested_legendary_action_attack_bonus[]" placeholder="Attack bonus">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-danger w-100" onclick="removeNestedLegendaryAction(this)">Remove</button>
        </div>
      </div>
      <div class="mb-2">
        <textarea class="form-control" name="nested_legendary_action_desc[]" placeholder="Nested action description" rows="2"></textarea>
      </div>
    `;
    nestedContainer.appendChild(newEntry);
  }

  function removeNestedLegendaryAction(button) {
    const entry = button.closest('.nested-action');
    entry.remove();
  }
</script>
{% endblock %}
